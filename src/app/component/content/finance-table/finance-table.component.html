<mat-drawer-container autosize class="height-full">
  <div layout="column" layout-align=" space-around center" class="height-full">
    <div layout="row" layout-align="space-between center">
      <span class="pad-left-sm">Таблица финансов</span>
      <div layout="row" layout-align="end center">
        <button mat-icon-button>
          <mat-icon matTooltip="Добавить" (click)="addRecord()">
            add
          </mat-icon>
        </button>
        <button mat-icon-button>
          <mat-icon matTooltip="Действия" [matMenuTriggerFor]="actions">
            more_horiz
          </mat-icon>
        </button>
        <mat-menu #actions="matMenu">
          <button mat-menu-item>
            -
          </button>
        </mat-menu>
      </div>
    </div>
    <div flex="grow" class="background-white">
      <table mat-table #matFinanceTable [dataSource]="dataSource" class="width-full" *ngIf="recordData.length > 0">
        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef>Категория</th>
          <td mat-cell *matCellDef="let element"> {{element.category.name}} </td>
        </ng-container>

        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef>Сумма</th>
          <td mat-cell *matCellDef="let element"> {{element.amount}} &#8381;</td>
        </ng-container>

        <ng-container matColumnDef="account">
          <th mat-header-cell *matHeaderCellDef>Счет</th>
          <td mat-cell *matCellDef="let element"> {{element.account.name}} </td>
        </ng-container>

        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>Дата</th>
          <td mat-cell *matCellDef="let element"> {{element.loadDate | date: 'dd.MM.yyyy'}} </td>
        </ng-container>

        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef>
            <button mat-icon-button (click)="hideActionColumn()">
              <mat-icon>
                remove
              </mat-icon>
            </button>
          </th>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
        <tr mat-row *matRowDef="let row; columns: columnsToDisplay;"
            class="finance-record-row" (click)="openDrawer(row)"></tr>
      </table>
      <div *ngIf="recordData.length === 0" class="mat-body-1 height-full" layout="row" layout-align="center center">
        Записей нет
      </div>
    </div>
    <mat-paginator [pageSizeOptions]="[10, 20, 30]" showFirstLastButtons></mat-paginator>
  </div>

  <mat-drawer #recordDrawer mode="side" position="end" class="finance-record-data">
    <div *ngIf="openRow" class="height-full" layout="column">
      <div layout="row" layout-align="space-between center">
        <h3 class="pad-left-sm">
          Запись от {{openRow.date | date: 'dd.MM.yyyy'}}
          <div class="mat-small">Дата создания: {{openRow.loadDate | date: 'dd.MM.yyyy'}}</div>
        </h3>
        <button mat-icon-button
                *ngIf="canEdit(openRow)"
                (click)="deleteFinanceRecord(openRow)" class="pad-right-md">
          <mat-icon>
            delete
          </mat-icon>
        </button>
      </div>
      <mat-divider></mat-divider>
      <div flex-grow layout-align="space-between start" class="finance-record-data-form">
        <form [formGroup]="editForm" layout="column" layout-align="center stretch" class="pad-md">
          <mat-form-field>
            <mat-label>Сумма</mat-label>
            <input matInput type="number" [formControl]="editForm.get('amount')" [readonly]="!canEdit(openRow)">
            <span matSuffix><b>&#8381;</b></span>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Счет</mat-label>
            <mat-select [formControl]="editForm.get('account')">
              <mat-option *ngFor="let account of accounts" [value]="account.id">
                {{account.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Категория</mat-label>
            <mat-select [formControl]="editForm.get('category')">
              <ng-container *ngFor="let category of categories">
                <mat-option [value]="category.id">
                  {{category.name}}
                </mat-option>
                <mat-option *ngFor="let child of category.children" [value]="child.id">
                  {{child.name}}
                </mat-option>
              </ng-container>
            </mat-select>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Примечание</mat-label>
            <textarea matInput [formControl]="editForm.get('description')" [readonly]="!canEdit(openRow)"></textarea>
          </mat-form-field>
        </form>
        <div class="bottom-button pad-right-sm" layout="row" layout-align="end center">
          <button mat-fab (click)="edit(editForm, openRow)" [disabled]="editForm.invalid || editForm.pristine">
            <mat-icon>save</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </mat-drawer>

</mat-drawer-container>
